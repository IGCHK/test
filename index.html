<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Performance Tester</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        .test-section {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background: #2980b9;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
            background: #ecf0f1;
        }
        .progress-container {
            width: 100%;
            background: #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .progress-bar {
            height: 20px;
            background: #2ecc71;
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s;
        }
        .warning {
            color: #e67e22;
        }
        .error {
            color: #e74c3c;
        }
        .success {
            color: #2ecc71;
        }
        canvas {
            border: 1px solid #ddd;
            margin: 10px 0;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .report {
            background: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .report-item {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .hidden {
            display: none;
        }
        #temperatureWarning {
            background: #f39c12;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Device Performance Tester</h1>
    <p>Test various aspects of your device's performance including CPU, GPU, memory, and more.</p>
    
    <div id="temperatureWarning">
        Warning: Device temperature may be increasing. Consider stopping intensive tests.
    </div>

    <div class="test-section">
        <h2>1. Basic Information</h2>
        <div id="basicInfo" class="result">
            Testing... <span id="loadTime"></span>
        </div>
        <div id="batteryInfo" class="result hidden"></div>
    </div>

    <div class="test-section">
        <h2>2. CPU Stress Test</h2>
        <p>This test will calculate prime numbers to stress the CPU.</p>
        <button id="cpuTestBtn">Start CPU Test</button>
        <div class="progress-container">
            <div id="cpuProgress" class="progress-bar"></div>
        </div>
        <div id="cpuResult" class="result"></div>
        <div id="cpuTemperature" class="result hidden"></div>
    </div>

    <div class="test-section">
        <h2>3. Memory Test</h2>
        <p>This test will allocate and manipulate large arrays to test memory performance.</p>
        <button id="memoryTestBtn">Start Memory Test</button>
        <div class="progress-container">
            <div id="memoryProgress" class="progress-bar"></div>
        </div>
        <div id="memoryResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>4. GPU/Graphics Test</h2>
        <p>This test will render complex graphics to test GPU performance.</p>
        <canvas id="gpuCanvas" width="800" height="400"></canvas>
        <button id="gpuTestBtn">Start GPU Test</button>
        <div id="gpuResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>5. Storage Speed Test</h2>
        <p>This test measures read/write speed to the device's storage.</p>
        <button id="storageTestBtn">Start Storage Test</button>
        <div id="storageResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>6. Network Test</h2>
        <p>This test measures download and upload speed (requires internet connection).</p>
        <button id="networkTestBtn">Start Network Test</button>
        <div id="networkResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>7. Battery Test (if available)</h2>
        <p>This test monitors battery drain rate during other tests.</p>
        <div id="batteryTestResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>8. Multi-Tasking Test</h2>
        <p>This test runs multiple operations simultaneously to test how well the device handles multi-tasking.</p>
        <button id="multiTaskTestBtn">Start Multi-Tasking Test</button>
        <div id="multiTaskResult" class="result"></div>
    </div>

    <div class="test-section hidden" id="reportSection">
        <h2>Performance Report</h2>
        <div class="report" id="performanceReport">
            <!-- Report will be generated here -->
        </div>
        <button id="saveReportBtn">Save Report as Text</button>
    </div>

    <script>
        // Basic device info and page load time
        document.addEventListener('DOMContentLoaded', function() {
            const loadStart = performance.now();
            
            window.onload = function() {
                const loadEnd = performance.now();
                const loadTime = (loadEnd - loadStart).toFixed(2);
                document.getElementById('loadTime').textContent = `Page loaded in ${loadTime} ms`;
                
                // Gather basic device info
                let basicInfo = `
                    <h3>Device Information</h3>
                    <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
                    <p><strong>Platform:</strong> ${navigator.platform}</p>
                    <p><strong>Logical Processors:</strong> ${navigator.hardwareConcurrency || 'Unknown'}</p>
                    <p><strong>Screen Resolution:</strong> ${window.screen.width}x${window.screen.height}</p>
                    <p><strong>Color Depth:</strong> ${window.screen.colorDepth} bits</p>
                    <p><strong>Device Memory (approx):</strong> ${navigator.deviceMemory || 'Unknown'} GB</p>
                    <p><strong>Touch Support:</strong> ${'ontouchstart' in window ? 'Yes' : 'No'}</p>
                `;
                
                document.getElementById('basicInfo').innerHTML = basicInfo;
                
                // Check for battery API
                if ('getBattery' in navigator) {
                    navigator.getBattery().then(function(battery) {
                        let batteryInfo = `
                            <h3>Battery Information</h3>
                            <p><strong>Battery Level:</strong> ${Math.floor(battery.level * 100)}%</p>
                            <p><strong>Charging:</strong> ${battery.charging ? 'Yes' : 'No'}</p>
                            <p><strong>Battery Health:</strong> Monitoring during tests...</p>
                        `;
                        document.getElementById('batteryInfo').innerHTML = batteryInfo;
                        document.getElementById('batteryInfo').classList.remove('hidden');
                        
                        battery.addEventListener('levelchange', function() {
                            document.getElementById('batteryTestResult').innerHTML = `
                                <p><strong>Battery Drain:</strong> ${Math.floor(battery.level * 100)}% remaining</p>
                                <p><strong>Charging Status:</strong> ${battery.charging ? 'Charging' : 'Discharging'}</p>
                            `;
                        });
                    });
                } else {
                    document.getElementById('batteryTestResult').innerHTML = 
                        '<p class="warning">Battery API not available in this browser.</p>';
                }
            };
        });

        // CPU Test
        document.getElementById('cpuTestBtn').addEventListener('click', function() {
            const btn = this;
            btn.disabled = true;
            btn.textContent = 'Testing...';
            const cpuResult = document.getElementById('cpuResult');
            const cpuProgress = document.getElementById('cpuProgress');
            cpuResult.innerHTML = '<p>Running CPU stress test...</p>';
            
            let startTime = performance.now();
            let progress = 0;
            let primeCount = 0;
            let maxNumber = 100000; // Adjust for longer/shorter tests
            
            // Simulate temperature monitoring
            let tempInterval = setInterval(() => {
                let tempElement = document.getElementById('cpuTemperature');
                tempElement.innerHTML = `<p><strong>Simulated CPU Temperature:</strong> ${Math.floor(40 + Math.random() * 30)}Â°C</p>`;
                tempElement.classList.remove('hidden');
                
                // Show warning if temperature is high
                if (Math.random() > 0.7) {
                    document.getElementById('temperatureWarning').style.display = 'block';
                }
            }, 2000);
            
            function calculatePrimes() {
                let primes = [];
                for (let i = 2; i < maxNumber; i++) {
                    let isPrime = true;
                    for (let j = 2; j <= Math.sqrt(i); j++) {
                        if (i % j === 0) {
                            isPrime = false;
                            break;
                        }
                    }
                    if (isPrime) {
                        primes.push(i);
                        primeCount++;
                    }
                    
                    // Update progress
                    if (i % 1000 === 0) {
                        progress = Math.floor((i / maxNumber) * 100);
                        cpuProgress.style.width = `${progress}%`;
                        
                        // Yield to UI thread occasionally
                        if (i % 5000 === 0) {
                            setTimeout(calculatePrimes, 0);
                            return;
                        }
                    }
                }
                
                // Test complete
                let endTime = performance.now();
                let duration = (endTime - startTime).toFixed(2);
                cpuResult.innerHTML = `
                    <p class="success">CPU test completed in ${duration} ms</p>
                    <p><strong>Primes calculated:</strong> ${primeCount}</p>
                    <p><strong>Performance score:</strong> ${Math.floor(1000000 / duration)}</p>
                `;
                btn.disabled = false;
                btn.textContent = 'Start CPU Test';
                cpuProgress.style.width = '100%';
                clearInterval(tempInterval);
            }
            
            calculatePrimes();
        });

        // Memory Test
        document.getElementById('memoryTestBtn').addEventListener('click', function() {
            const btn = this;
            btn.disabled = true;
            btn.textContent = 'Testing...';
            const memoryResult = document.getElementById('memoryResult');
            const memoryProgress = document.getElementById('memoryProgress');
            memoryResult.innerHTML = '<p>Running memory test...</p>';
            
            let startTime = performance.now();
            let testSize = 10000000; // 10 million elements
            let testArray = new Array(testSize);
            let progress = 0;
            
            function testMemory() {
                // Fill array
                for (let i = 0; i < testSize; i++) {
                    testArray[i] = Math.random();
                    
                    // Update progress
                    if (i % 100000 === 0) {
                        progress = Math.floor((i / testSize) * 100);
                        memoryProgress.style.width = `${progress}%`;
                        
                        // Yield to UI thread occasionally
                        if (i % 500000 === 0) {
                            setTimeout(testMemory, 0);
                            return;
                        }
                    }
                }
                
                // Manipulate array
                let sum = 0;
                for (let i = 0; i < testSize; i++) {
                    testArray[i] = testArray[i] * 2;
                    sum += testArray[i];
                    
                    // Update progress (from 50-100%)
                    if (i % 100000 === 0) {
                        progress = 50 + Math.floor((i / testSize) * 50);
                        memoryProgress.style.width = `${progress}%`;
                        
                        if (i % 500000 === 0) {
                            setTimeout(() => {}, 0);
                        }
                    }
                }
                
                // Test complete
                let endTime = performance.now();
                let duration = (endTime - startTime).toFixed(2);
                memoryResult.innerHTML = `
                    <p class="success">Memory test completed in ${duration} ms</p>
                    <p><strong>Array size:</strong> ${testSize.toLocaleString()} elements</p>
                    <p><strong>Memory operations:</strong> ${(testSize * 2).toLocaleString()}</p>
                    <p><strong>Performance score:</strong> ${Math.floor(10000000 / duration)}</p>
                `;
                btn.disabled = false;
                btn.textContent = 'Start Memory Test';
                memoryProgress.style.width = '100%';
                
                // Force garbage collection (where supported)
                testArray = null;
                if (window.gc) {
                    window.gc();
                }
            }
            
            testMemory();
        });

        // GPU Test
        document.getElementById('gpuTestBtn').addEventListener('click', function() {
            const btn = this;
            btn.disabled = true;
            btn.textContent = 'Testing...';
            const gpuResult = document.getElementById('gpuResult');
            const canvas = document.getElementById('gpuCanvas');
            const ctx = canvas.getContext('2d');
            
            gpuResult.innerHTML = '<p>Running GPU test... Watch the animation smoothness</p>';
            
            let startTime = performance.now();
            let frames = 0;
            let lastFrameTime = startTime;
            let frameTimes = [];
            
            function drawFrame(timestamp) {
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw complex shapes
                for (let i = 0; i < 50; i++) {
                    const x = Math.sin(timestamp / 1000 + i) * 200 + canvas.width / 2;
                    const y = Math.cos(timestamp / 1000 + i * 0.7) * 100 + canvas.height / 2;
                    const radius = 20 + Math.sin(timestamp / 500 + i) * 15;
                    const hue = (timestamp / 10 + i * 10) % 360;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.fillStyle = `hsl(${hue}, 80%, 60%)`;
                    ctx.fill();
                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.stroke();
                    
                    // Add some gradient fills
                    const grad = ctx.createRadialGradient(x, y, 0, x, y, radius);
                    grad.addColorStop(0, `hsl(${hue}, 100%, 80%)`);
                    grad.addColorStop(1, `hsl(${hue}, 100%, 30%)`);
                    ctx.fillStyle = grad;
                    ctx.fill();
                }
                
                // Draw some complex paths
                ctx.beginPath();
                for (let i = 0; i < 100; i++) {
                    const x = (canvas.width / 100) * i;
                    const y = canvas.height / 2 + Math.sin(timestamp / 300 + i / 10) * 100;
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.lineWidth = 3;
                ctx.strokeStyle = 'rgba(255, 0, 0, 0.7)';
                ctx.stroke();
                
                // Count frames and measure performance
                frames++;
                const now = performance.now();
                frameTimes.push(now - lastFrameTime);
                lastFrameTime = now;
                
                // Run for about 5 seconds
                if (now - startTime < 5000) {
                    requestAnimationFrame(drawFrame);
                } else {
                    // Test complete
                    const avgFrameTime = frameTimes.reduce((a, b) => a + b, 0) / frameTimes.length;
                    const fps = 1000 / avgFrameTime;
                    
                    gpuResult.innerHTML = `
                        <p class="success">GPU test completed</p>
                        <p><strong>Frames rendered:</strong> ${frames}</p>
                        <p><strong>Average FPS:</strong> ${fps.toFixed(1)}</p>
                        <p><strong>Frame time:</strong> ${avgFrameTime.toFixed(2)} ms</p>
                        <p><strong>Performance score:</strong> ${Math.floor(fps * 10)}</p>
                    `;
                    btn.disabled = false;
                    btn.textContent = 'Start GPU Test';
                }
            }
            
            requestAnimationFrame(drawFrame);
        });

        // Storage Test
        document.getElementById('storageTestBtn').addEventListener('click', function() {
            const btn = this;
            btn.disabled = true;
            btn.textContent = 'Testing...';
            const storageResult = document.getElementById('storageResult');
            storageResult.innerHTML = '<p>Running storage speed test...</p>';
            
            let startTime = performance.now();
            let testSize = 1000000; // 1MB of data
            let testData = new Array(testSize).join('x'); // Create a large string
            let operations = 0;
            
            function testLocalStorage() {
                try {
                    // Test localStorage write speed
                    let writeStart = performance.now();
                    localStorage.setItem('storageTest', testData);
                    let writeEnd = performance.now();
                    let writeTime = writeEnd - writeStart;
                    
                    // Test localStorage read speed
                    let readStart = performance.now();
                    let data = localStorage.getItem('storageTest');
                    let readEnd = performance.now();
                    let readTime = readEnd - readStart;
                    
                    // Clean up
                    localStorage.removeItem('storageTest');
                    
                    // Calculate results
                    let endTime = performance.now();
                    let duration = (endTime - startTime).toFixed(2);
                    
                    storageResult.innerHTML = `
                        <p class="success">Storage test completed in ${duration} ms</p>
                        <p><strong>Write speed:</strong> ${(testSize / (writeTime / 1000)).toLocaleString()} bytes/sec</p>
                        <p><strong>Read speed:</strong> ${(testSize / (readTime / 1000)).toLocaleString()} bytes/sec</p>
                        <p><strong>Performance score:</strong> ${Math.floor(1000000 / (writeTime + readTime))}</p>
                    `;
                } catch (e) {
                    storageResult.innerHTML = `
                        <p class="error">Storage test failed: ${e.message}</p>
                        <p>This may be due to storage restrictions in private browsing mode.</p>
                    `;
                }
                
                btn.disabled = false;
                btn.textContent = 'Start Storage Test';
            }
            
            setTimeout(testLocalStorage, 0);
        });

        // Network Test
        document.getElementById('networkTestBtn').addEventListener('click', function() {
            const btn = this;
            btn.disabled = true;
            btn.textContent = 'Testing...';
            const networkResult = document.getElementById('networkResult');
            networkResult.innerHTML = '<p>Running network speed test... This requires an internet connection</p>';
            
            // We'll use a simple approach by downloading a small file
            const testFileUrl = 'https://httpbin.org/bytes/1000000'; // 1MB file
            let startTime, endTime;
            let fileSize = 1000000; // 1MB in bytes
            
            startTime = performance.now();
            
            fetch(testFileUrl, { cache: 'no-store' })
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.blob();
                })
                .then(blob => {
                    endTime = performance.now();
                    let duration = (endTime - startTime) / 1000; // in seconds
                    let speed = (fileSize / duration) / 1024 / 1024; // MB/s
                    
                    networkResult.innerHTML = `
                        <p class="success">Download test completed</p>
                        <p><strong>Download speed:</strong> ${speed.toFixed(2)} MB/s</p>
                        <p><strong>Performance score:</strong> ${Math.floor(speed * 100)}</p>
                    `;
                    
                    // Now test upload (simulated)
                    return new Promise(resolve => setTimeout(resolve, 1000));
                })
                .then(() => {
                    networkResult.innerHTML += '<p>Testing upload speed (simulated)...</p>';
                    startTime = performance.now();
                    
                    // Simulate upload by sending data (not actually uploaded anywhere)
                    let uploadData = new Blob([new ArrayBuffer(500000)]); // 500KB
                    let formData = new FormData();
                    formData.append('data', uploadData);
                    
                    return fetch('https://httpbin.org/post', {
                        method: 'POST',
                        body: formData,
                        cache: 'no-store'
                    });
                })
                .then(response => {
                    if (!response.ok) throw new Error('Upload failed');
                    return response.json();
                })
                .then(data => {
                    endTime = performance.now();
                    let duration = (endTime - startTime) / 1000; // in seconds
                    let speed = (500000 / duration) / 1024 / 1024; // MB/s
                    
                    networkResult.innerHTML += `
                        <p class="success">Upload test completed</p>
                        <p><strong>Upload speed:</strong> ${speed.toFixed(2)} MB/s</p>
                        <p><strong>Performance score:</strong> ${Math.floor(speed * 100)}</p>
                    `;
                })
                .catch(error => {
                    networkResult.innerHTML = `
                        <p class="error">Network test failed: ${error.message}</p>
                        <p>Please check your internet connection and try again.</p>
                    `;
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.textContent = 'Start Network Test';
                });
        });

        // Multi-Tasking Test
        document.getElementById('multiTaskTestBtn').addEventListener('click', function() {
            const btn = this;
            btn.disabled = true;
            btn.textContent = 'Testing...';
            const multiTaskResult = document.getElementById('multiTaskResult');
            multiTaskResult.innerHTML = '<p>Running multi-tasking test...</p>';
            
            let startTime = performance.now();
            let testDuration = 5000; // 5 seconds
            let operations = 0;
            
            // Run multiple types of operations simultaneously
            function runCPUTask() {
                // Simple prime calculation
                for (let i = 0; i < 1000; i++) {
                    isPrime(i);
                }
                operations += 1000;
                
                if (performance.now() - startTime < testDuration) {
                    setTimeout(runCPUTask, 0);
                }
            }
            
            function runMemoryTask() {
                // Allocate and manipulate arrays
                let arr = new Array(10000);
                for (let i = 0; i < 10000; i++) {
                    arr[i] = Math.random();
                }
                arr.sort();
                operations += 10000;
                
                if (performance.now() - startTime < testDuration) {
                    setTimeout(runMemoryTask, 0);
                }
            }
            
            function runCanvasTask() {
                // Simple canvas drawing
                const canvas = document.createElement('canvas');
                canvas.width = 100;
                canvas.height = 100;
                const ctx = canvas.getContext('2d');
                
                for (let i = 0; i < 100; i++) {
                    ctx.fillStyle = `rgb(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255})`;
                    ctx.fillRect(Math.random() * 100, Math.random() * 100, 10, 10);
                }
                operations += 100;
                
                if (performance.now() - startTime < testDuration) {
                    setTimeout(runCanvasTask, 0);
                }
            }
            
            function isPrime(num) {
                if (num <= 1) return false;
                for (let i = 2; i <= Math.sqrt(num); i++) {
                    if (num % i === 0) return false;
                }
                return true;
            }
            
            // Start all tasks
            runCPUTask();
            runMemoryTask();
            runCanvasTask();
            
            // Monitor progress
            let progressInterval = setInterval(() => {
                let elapsed = performance.now() - startTime;
                if (elapsed >= testDuration) {
                    clearInterval(progressInterval);
                    let endTime = performance.now();
                    let duration = (endTime - startTime).toFixed(2);
                    
                    multiTaskResult.innerHTML = `
                        <p class="success">Multi-tasking test completed in ${duration} ms</p>
                        <p><strong>Total operations:</strong> ${operations.toLocaleString()}</p>
                        <p><strong>Operations per second:</strong> ${Math.floor(operations / (duration / 1000)).toLocaleString()}</p>
                        <p><strong>Performance score:</strong> ${Math.floor(operations / 100)}</p>
                    `;
                    btn.disabled = false;
                    btn.textContent = 'Start Multi-Tasking Test';
                }
            }, 100);
        });

        // Generate report
        function generateReport() {
            const reportSection = document.getElementById('reportSection');
            const report = document.getElementById('performanceReport');
            
            reportSection.classList.remove('hidden');
            
            let reportHTML = `
                <h3>Device Performance Report</h3>
                <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
                <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
                
                <h4>Test Results</h4>
            `;
            
            // Collect all test results
            const testSections = document.querySelectorAll('.test-section');
            testSections.forEach(section => {
                const title = section.querySelector('h2').textContent;
                const result = section.querySelector('.result').innerHTML;
                
                reportHTML += `
                    <div class="report-item">
                        <h5>${title}</h5>
                        ${result}
                    </div>
                `;
            });
            
            reportHTML += `
                <h4>Summary</h4>
                <p>This report provides an overview of your device's performance across various metrics.
                Higher scores indicate better performance. Compare these results with other devices
                to evaluate relative performance.</p>
            `;
            
            report.innerHTML = reportHTML;
            
            // Scroll to report
            reportSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Save report as text file
        document.getElementById('saveReportBtn').addEventListener('click', function() {
            const reportText = document.getElementById('performanceReport').textContent;
            const blob = new Blob([reportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'device_performance_report.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
        
        // Auto-generate report after all tests are run (for demo purposes)
        // In a real scenario, you'd want to trigger this manually after running tests
        setTimeout(generateReport, 10000);
    </script>
</body>
</html>
